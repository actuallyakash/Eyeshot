!function(t){"use strict";t.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var e=function(e,n){var o,i=e.data("jscroll"),r="function"==typeof n?{callback:n}:n,l=t.extend({},t.jscroll.defaults,r,i||{}),a="visible"===e.css("overflow-y"),c=e.find(l.nextSelector).first(),s=t(window),d=t("body"),f=a?s:e,g=t.trim(c.prop("href")+" "+l.contentSelector),p=function(){e.find(".feed-inner").length||e.contents().wrapAll('<div class="feed-inner" />')},u=function(t){l.pagingSelector?t.closest(l.pagingSelector).hide():t.parent().not(".feed-inner,.rants-paginate").addClass("jscroll-next-parent").hide().length||t.wrap('<div class="jscroll-next-parent" />').parent().hide()},h=function(){return f.unbind(".jscroll").removeData("jscroll").find(".feed-inner").children().unwrap().filter(".rants-paginate").children().unwrap()},j=function(){if(e.is(":visible")){p();var t=e.find("div.feed-inner").first(),n=e.data("jscroll"),o=parseInt(e.css("borderTopWidth"),10),i=isNaN(o)?0:o,r=parseInt(e.css("paddingTop"),10)+i,c=a?f.scrollTop():e.offset().top,s=t.length?t.offset().top:0,d=Math.ceil(c-s+f.height()+r);if(!n.waiting&&d+l.padding>=t.outerHeight())return m("info","jScroll:",t.outerHeight()-d,"from bottom. Loading next request..."),b()}},v=function(){var n=e.find(l.nextSelector).first();if(n.length)if(l.autoTrigger&&(!1===l.autoTriggerUntil||0<l.autoTriggerUntil)){u(n);var o=d.height()-e.offset().top;(e.height()<o?e.height():o)<=(0<e.offset().top-s.scrollTop()?s.height()-(e.offset().top-t(window).scrollTop()):s.height())&&j(),f.unbind(".jscroll").bind("scroll.jscroll",function(){return j()}),0<l.autoTriggerUntil&&l.autoTriggerUntil--}else f.unbind(".jscroll"),n.bind("click.jscroll",function(){return u(n),b(),!1})},b=function(){var n=e.find("div.feed-inner").first(),o=e.data("jscroll");return o.waiting=!0,n.append('<div class="rants-paginate" />').children(".rants-paginate").last().html('<div class="jscroll-loading" id="jscroll-loading">'+l.loadingHtml+"</div>").promise().done(function(){l.loadingFunction&&l.loadingFunction()}),e.animate({scrollTop:n.outerHeight()},0,function(){var i=o.nextHref;n.find("div.rants-paginate").last().load(i,function(n,r){if("error"===r)return h();var a,c=t(this).find(l.nextSelector).first();o.waiting=!1,o.nextHref=!!c.prop("href")&&t.trim(c.prop("href")+" "+l.contentSelector),t(".jscroll-next-parent",e).remove(),(a=a||e.data("jscroll"))&&a.nextHref?v():(m("warn","jScroll: nextSelector not found - destroying"),h()),l.callback&&l.callback.call(this,i),m("dir",o)})})},m=function(t){if(l.debug&&"object"==typeof console&&("object"==typeof t||"function"==typeof console[t]))if("object"==typeof t){var e=[];for(var n in t)"function"==typeof console[n]?(e=t[n].length?t[n]:[t[n]],console[n].apply(console,e)):console.log.apply(console,e)}else console[t].apply(console,Array.prototype.slice.call(arguments,1))};return e.data("jscroll",t.extend({},i,{initialized:!0,waiting:!1,nextHref:g})),p(),(o=t(l.loadingHtml).filter("img").attr("src"))&&((new Image).src=o),v(),t.extend(e.jscroll,{destroy:h}),e};t.fn.jscroll=function(n){return this.each(function(){var o=t(this),i=o.data("jscroll");i&&i.initialized||e(o,n)})}}(jQuery);