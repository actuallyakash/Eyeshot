(function(e){function t(e,t){var a=e.lng,o=e.lat,n=t/111300,s=Math.random(),i=Math.random(),r=n*Math.sqrt(s),l=2*Math.PI*i,c=r*Math.cos(l),u=r*Math.sin(l),h=c/Math.cos(o);return{lat:u+o,lng:h+a}}function a(){e("#landing-pano .loader").css("display","block"),e("#landing-pano #sv-pano").css("display","none");var a=[[43.0822473,-79.0635906],[37.869085,-122.254775],[51.5286416,-.1015987],[47.3721915,8.5425051],[46.7972162,9.8334775],[55.6993533,12.5423634],[38.470495,-78.7748714],[37.42197,-122.084373],[-4.3538688,55.8300366]],o=a[Math.floor(Math.random()*(a.length-1)+1)],n=t({lat:o[0],lng:o[1]},2e3),s=Number(n.lat),i=Number(n.lng);l(s,i)}var o,n;e(function(){e('[data-tooltip="tooltip"]').tooltip()});var s=function(t){var a=e("#sv-pano .cta-street-view");if(a.length){a.attr("data-id","fav-"+t);var o="";(o=a.attr("class").match(/fav-\S+/g))&&a.removeClass(o),a.addClass("fav-"+t),e.ajax({type:"GET",url:"/location/"+t+"/status",success:function(e){1==e?(a.attr("title","Unlike"),a.attr("data-original-title","Unlike"),a.removeClass("unfavourite-sv").addClass("favourite-sv"),a.children("i").removeClass("far").addClass("fas")):(a.attr("title","Favourite"),a.attr("data-original-title","Favourite"),a.removeClass("favourite-sv").addClass("unfavourite-sv"),a.children("i").removeClass("fas").addClass("far"))}})}},i=function(t,o){"OK"===o?(e("#landing-pano .loader").css("display","none"),e("#landing-pano #sv-pano").css("display","block"),n.setPano(t.location.pano),n.setPov({heading:270,pitch:0}),n.setVisible(!0)):a()},r=function(e,t,a,r,l,c,u,h){var d={lat:e,lng:t},v=new google.maps.StreetViewService;o=new google.maps.Map(u,{center:d,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0}),n=new google.maps.StreetViewPanorama(h,{position:d,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),o.setStreetView(n),v.getPanorama({location:d,radius:50},i),o.addListener("click",function(e){v.getPanorama({location:e.latLng,radius:100},i)}),n.addListener("pano_changed",function(){var e=n.getPano();s(e)})},l=function(t,a){var r={lat:t,lng:a},l=new google.maps.StreetViewService;o=new google.maps.Map(document.getElementById("sv-map"),{center:r,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0}),n=new google.maps.StreetViewPanorama(document.getElementById("sv-pano"),{position:r,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),o.setStreetView(n),l.getPanorama({location:r,radius:50},i),o.addListener("click",function(e){l.getPanorama({location:e.latLng,radius:100},i)}),n.addListener("pano_changed",function(){var e=n.getPano();s(e)}),e("#landing-pano").on("click",function(){e("html, body").animate({scrollTop:e("#landing-pano").offset().top},"fast")})},c=function(t,a,s){var i=o.streetView.location.description,r=o.center.lat(),l=o.center.lng(),c=n.getPov().heading,u=n.getPov().pitch,h=n.zoom;switch(e("#favouriteBox .eyeshot-title").attr("value",i),a){case"favourite":e.ajax({type:"GET",url:"/location/favourite/"+i+"/"+r+"/"+l+"/"+t+"/"+c+"/"+u+"/"+h,success:function(e){1==e?(s.attr("title","Unlike"),s.attr("data-original-title","Unlike"),s.removeClass("unfavourite-sv").addClass("favourite-sv"),s.children("i").removeClass("far").addClass("fas")):console.log("#12 Something went wrong! Can't favourite location.")}});break;case"unfavourite":e.ajax({type:"DELETE",url:"/location/"+t+"/unfavourite/",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(e){1==e?(s.attr("title","Like"),s.attr("data-original-title","Like"),s.removeClass("favourite-sv").addClass("unfavourite-sv"),s.children("i").removeClass("fas").addClass("far")):console.log("#13 Something went wrong! Can't unfavourite location.")}})}},u=function(t,a,o,n){e.ajax({type:"POST",url:"/favourite/details",data:{panoId:t,title:a,status:o,tags:n},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(t){1==t?(e("#favouriteBox").modal("hide"),e("#favouriteBox textarea.status").val(""),tagify.removeAllTags(),e(".toast-location-share").toast({delay:2e3}),e(".toast-location-share").toast("show")):console.log("#212 Something went wrong! Can't save details.")}})};e(document).ready(function(){if(e("#landing-pano").length&&a(),e("#shared-pano").length){var t=new URL(window.location.href).searchParams.get("s"),n=atob(t),i=n.split(":"),l=document.querySelector("#shared-pano #sv-map"),c=document.querySelector("#shared-pano #sv-pano");s(i[2]),r(Number(i[0]),Number(i[1]),i[2],Number(i[3]),Number(i[4]),Number(i[5]),l,c),setTimeout(function(){e("#shared-pano").after('<div class="details text-center"><h3 class="eyeshot-info"> <span class="text-muted">Location: </span>'+o.streetView.location.description+"</h3></div>"),e("meta.meta-title").attr("content",o.streetView.location.description+" | Eyeshot"),e("meta.meta-keywords").attr("content",o.streetView.location.description),e("meta.meta-image").attr("content","https://maps.googleapis.com/maps/api/streetview?size=600x400&pano="+i[2]+"&heading="+i[3]+"&pitch="+i[4]+"&key=AIzaSyDTJbCnWZ2ZpG9ZAkf66SNfvLb9sUchknw")},2e3)}console.log("%cüåè","font-size:20px;"),console.log("%cHaving fun using Eyeshot? Wanna contribute or maybe give a star üòÅ. Join us:\nhttp://github.com/actuallyakash/eyeshot","color: #6697FE; font-size: 12px;")}),e("div#sv-pano").on("click","button.unfavourite-sv",function(){var t=e(this).attr("data-id").replace("fav-",""),a=e("button.fav-"+t);e("#favouriteBox").modal(),c(t,"favourite",a)}),e("div#sv-pano").on("click","button.favourite-sv",function(){var t=e(this).attr("data-id").replace("fav-",""),a=e("button.fav-"+t);c(t,"unfavourite",a)}),e("div#favouriteBox").on("click","button.btn-fav-info",function(t){t.preventDefault();var a=e("div#sv-pano button.cta-street-view").attr("data-id").replace("fav-",""),o=e("input[name=title]").val(),n=e("textarea.status").val(),s=e("input[name=tags]").val();u(a,o,n,s)});var h=document.querySelector('#favouriteBox input[name="tags"]');null!==h&&(tagify=new Tagify(h)),e("div.eyeshot-feed").on("click",".eyeshot .eyeshot-media",function(){var t=e(this).data("eyeshot").replace("eyeshot-","");e("#viewEyeshot").modal("show"),e("#viewEyeshot .eyeshot-location").text(""),e("#viewEyeshot .eyeshot-status").text(""),e("#viewEyeshot .eyeshot-tags").text(""),e("#viewEyeshot .loader").css("display","block"),e("#viewEyeshot .modal-content").css("display","none"),e.ajax({type:"GET",url:"/get/"+t+"/details",success:function(t){if(0!=t){var a=Number(t.latitude),o=Number(t.longitude);if(e("#viewEyeshot .eyeshot-avatar img").attr("src",t.user_avatar),e("#viewEyeshot .eyeshot-user .eyeshot-username").html("by <a href='"+t.user_nickname+"'>"+t.eyeshot_by+"</a>"),e("#viewEyeshot .eyeshot-location").text(t.location_name),null!==t.tags?e("#viewEyeshot .eyeshot-title").text(t.title):e("#viewEyeshot .eyeshot-title").text("Eyeshot by "+t.eyeshot_by),e("#viewEyeshot .eyeshot-status").text(t.status),null!==t.tags){var n=t.tags.split(",");n.map(t=>e("#viewEyeshot .eyeshot-tags").append("<a href='/search?q="+t+"' class='eyeshot-tag badge'>"+t+"</a>"))}else e("#viewEyeshot .eyeshot-tags").append("<a href='/search?q=eyeshot' class='eyeshot-tag badge'>Eyeshot</a>");e("#viewEyeshot .eyeshot-location").text(t.location_name),e("#viewEyeshot .eyeshot-published").text(t.created_at),e("#viewEyeshot .eyeshot-saves").text(t.eyeshot_saves+" saves"),s(t.pano_id);let i=document.querySelector("#viewEyeshot #sv-map"),l=document.querySelector("#viewEyeshot #sv-pano");r(a,o,t.pano_id,Number(t.pano_heading),Number(t.pano_pitch),t.pano_zoom,i,l),e("#viewEyeshot .loader").css("display","none"),e("#viewEyeshot .modal-content").css("display","block")}else console.log("No eyeshot found!")}})});var d=0;e("div#sv-pano").on("click","button.randomize-eyeshot",function(){a(),5==d++&&e("#loginSignupModal").modal("show")}),e("#shareEyeshot .copy-eyeshot-url").on("click",function(){e("#shareEyeshot .eyeshot-url").select(),document.execCommand("copy"),alert("Copied!")}),e("#sv-pano .share-eyeshot").on("click",function(){e("#shareEyeshot").modal("show");var t=n.getPosition().lat(),a=n.getPosition().lng(),o=n.getPano(),s=n.getPov().heading,i=n.getPov().pitch,r=n.getPov().zoom,l=btoa(t+":"+a+":"+o+":"+s+":"+i+":"+r),c="http://eyeshot.xyz?s="+l,u="https://www.facebook.com/sharer/sharer.php?u="+c,h="https://twitter.com/share?url="+c+"&via=eyeshot.xyz&text=roamingAtUnknownPlace";e("#shareEyeshot .share-url input").val(c),e("#shareEyeshot a.share-facebook").attr("href",u),e("#shareEyeshot a.share-twitter").attr("href",h)}),e(".sort-eyeshots select").on("change",function(){window.location="/"+e(this).val()}),e(function(){e(".eyeshot-container-fluid").jscroll({autoTrigger:!0,loadingHtml:'<div class="text-center"><span class="eyeshot-loader">üåè</span></div>',nextSelector:"ul.pagination li.active + li a",contentSelector:"div.eyeshot-feed",pagingSelector:"ul.pagination",callback:function(){e("ul.pagination:visible:first").hide()}})})})(jQuery);