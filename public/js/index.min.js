(function(t){function e(t,e){var a=t.lng,o=t.lat,n=e/111300,s=Math.random(),i=Math.random(),l=n*Math.sqrt(s),r=2*Math.PI*i,c=l*Math.cos(r),h=l*Math.sin(r),u=c/Math.cos(o);return{lat:h+o,lng:u+a}}function a(){t("#landing-pano .loader").css("display","block"),t("#landing-pano #sv-pano").css("display","none");var a=[[43.0822473,-79.0635906],[37.869085,-122.254775],[51.5286416,-.1015987],[47.3721915,8.5425051],[46.7972162,9.8334775],[55.6993533,12.5423634],[38.470495,-78.7748714],[37.42197,-122.084373],[-4.3538688,55.8300366]],o=a[Math.floor(Math.random()*(a.length-1)+1)],n=e({lat:o[0],lng:o[1]},2e3),s=Number(n.lat),i=Number(n.lng);r(s,i)}var o,n;t(function(){t('[data-tooltip="tooltip"]').tooltip()});var s=function(e){var a=t("#sv-pano .cta-street-view");if(a.length){a.attr("data-id","fav-"+e);var o="";(o=a.attr("class").match(/fav-\S+/g))&&a.removeClass(o),a.addClass("fav-"+e),t.ajax({type:"GET",url:"/location/"+e+"/status",success:function(t){1==t?(a.attr("title","Unlike"),a.attr("data-original-title","Unlike"),a.removeClass("unfavourite-sv").addClass("favourite-sv"),a.children("i").removeClass("far").addClass("fas")):(a.attr("title","Favourite"),a.attr("data-original-title","Favourite"),a.removeClass("favourite-sv").addClass("unfavourite-sv"),a.children("i").removeClass("fas").addClass("far"))}})}},i=function(e,o){"OK"===o?(t("#landing-pano .loader").css("display","none"),t("#landing-pano #sv-pano").css("display","block"),n.setPano(e.location.pano),n.setPov({heading:270,pitch:0}),n.setVisible(!0)):a()},l=function(t,e,a,l,r,c){var h={lat:t,lng:e},u=new google.maps.StreetViewService;o=new google.maps.Map(document.getElementById("sv-map"),{center:h,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0}),n=new google.maps.StreetViewPanorama(document.getElementById("sv-pano"),{position:h,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),o.setStreetView(n),u.getPanorama({location:h,radius:50},i),o.addListener("click",function(t){u.getPanorama({location:t.latLng,radius:100},i)}),n.addListener("pano_changed",function(){var t=n.getPano();s(t)})},r=function(e,a){var l={lat:e,lng:a},r=new google.maps.StreetViewService;o=new google.maps.Map(document.getElementById("sv-map"),{center:l,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0}),n=new google.maps.StreetViewPanorama(document.getElementById("sv-pano"),{position:l,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),o.setStreetView(n),r.getPanorama({location:l,radius:50},i),o.addListener("click",function(t){r.getPanorama({location:t.latLng,radius:100},i)}),n.addListener("pano_changed",function(){var t=n.getPano();s(t)}),t("#landing-pano").on("click",function(){t("html, body").animate({scrollTop:t("#landing-pano").offset().top},"fast")})},c=function(e,a,s){var i=o.streetView.location.description,l=o.center.lat(),r=o.center.lng(),c=n.getPov().heading,h=n.getPov().pitch,u=n.zoom;switch(t("#favouriteBox .eyeshot-title").attr("value",i),a){case"favourite":t.ajax({type:"GET",url:"/location/favourite/"+i+"/"+l+"/"+r+"/"+e+"/"+c+"/"+h+"/"+u,success:function(t){1==t?(s.attr("title","Unlike"),s.attr("data-original-title","Unlike"),s.removeClass("unfavourite-sv").addClass("favourite-sv"),s.children("i").removeClass("far").addClass("fas")):console.log("#12 Something went wrong! Can't favourite location.")}});break;case"unfavourite":t.ajax({type:"DELETE",url:"/location/"+e+"/unfavourite/",headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")},success:function(t){1==t?(s.attr("title","Like"),s.attr("data-original-title","Like"),s.removeClass("favourite-sv").addClass("unfavourite-sv"),s.children("i").removeClass("fas").addClass("far")):console.log("#13 Something went wrong! Can't unfavourite location.")}})}},h=function(e,a,o,n){t.ajax({type:"POST",url:"/favourite/details",data:{panoId:e,title:a,status:o,tags:n},headers:{"X-CSRF-TOKEN":t('meta[name="csrf-token"]').attr("content")},success:function(e){1==e?(t("#favouriteBox").modal("hide"),t("#favouriteBox textarea.status").val(""),tagify.removeAllTags(),t(".toast-location-share").toast({delay:2e3}),t(".toast-location-share").toast("show")):console.log("#212 Something went wrong! Can't save details.")}})};t(document).ready(function(){if(t("#landing-pano").length&&a(),t("#shared-pano").length){var e=new URL(window.location.href).searchParams.get("s"),n=atob(e),i=n.split(":");s(i[2]),l(Number(i[0]),Number(i[1]),i[2],Number(i[3]),Number(i[4]),Number(i[5])),setTimeout(function(){t("#shared-pano").after('<div class="details text-center"><h3 class="eyeshot-info"> <span class="text-muted">Location: </span>'+o.streetView.location.description+"</h3></div>"),t("meta.meta-title").attr("content",o.streetView.location.description+" | Eyeshot"),t("meta.meta-keywords").attr("content",o.streetView.location.description),t("meta.meta-image").attr("content","https://maps.googleapis.com/maps/api/streetview?size=600x400&pano="+i[2]+"&heading="+i[3]+"&pitch="+i[4]+"&key=AIzaSyDTJbCnWZ2ZpG9ZAkf66SNfvLb9sUchknw")},2e3)}console.log("%cüåè","font-size:20px;"),console.log("%cHaving fun using Eyeshot? Wanna contribute or maybe give a star üòÅ. Join us:\nhttp://github.com/actuallyakash/eyeshot","color: #6697FE; font-size: 12px;")}),t("div#sv-pano").on("click","button.unfavourite-sv",function(){var e=t(this).attr("data-id").replace("fav-",""),a=t("button.fav-"+e);t("#favouriteBox").modal(),c(e,"favourite",a)}),t("div#sv-pano").on("click","button.favourite-sv",function(){var e=t(this).attr("data-id").replace("fav-",""),a=t("button.fav-"+e);c(e,"unfavourite",a)}),t("div#favouriteBox").on("click","button.btn-fav-info",function(e){e.preventDefault();var a=t("div#sv-pano button.cta-street-view").attr("data-id").replace("fav-",""),o=t("input[name=title]").val(),n=t("textarea.status").val(),s=t("input[name=tags]").val();h(a,o,n,s)});var u=document.querySelector('#favouriteBox input[name="tags"]');null!==u&&(tagify=new Tagify(u)),t("div.eyeshot-feed").on("click",".eyeshot .eyeshot-media",function(){var e=t(this).data("eyeshot").replace("eyeshot-","");t("#viewEyeshot").modal("show"),t("#viewEyeshot .eyeshot-location").text(""),t("#viewEyeshot .eyeshot-status").text(""),t("#viewEyeshot .eyeshot-tags").text(""),t("#viewEyeshot .loader").css("display","block"),t("#viewEyeshot .modal-content").css("display","none"),t.ajax({type:"GET",url:"/get/"+e+"/details",success:function(e){if(0!=e){var a=Number(e.latitude),o=Number(e.longitude);if(t("#viewEyeshot .eyeshot-avatar img").attr("src",e.user_avatar),t("#viewEyeshot .eyeshot-user .eyeshot-username").html("by <a href='"+e.user_nickname+"'>"+e.eyeshot_by+"</a>"),t("#viewEyeshot .eyeshot-location").text(e.location_name),null!==e.tags?t("#viewEyeshot .eyeshot-title").text(e.title):t("#viewEyeshot .eyeshot-title").text("Eyeshot by "+e.eyeshot_by),t("#viewEyeshot .eyeshot-status").text(e.status),null!==e.tags){var n=e.tags.split(",");n.map(e=>t("#viewEyeshot .eyeshot-tags").append("<a href='/search?q="+e+"' class='eyeshot-tag badge'>"+e+"</a>"))}else t("#viewEyeshot .eyeshot-tags").append("<a href='/search?q=eyeshot' class='eyeshot-tag badge'>Eyeshot</a>");t("#viewEyeshot .eyeshot-location").text(e.location_name),t("#viewEyeshot .eyeshot-published").text(e.created_at),t("#viewEyeshot .eyeshot-saves").text(e.eyeshot_saves+" saves"),s(e.pano_id),l(a,o,e.pano_id,Number(e.pano_heading),Number(e.pano_pitch),e.pano_zoom),t("#viewEyeshot .loader").css("display","none"),t("#viewEyeshot .modal-content").css("display","block")}else console.log("No eyeshot found!")}})});var d=0;t("div#sv-pano").on("click","button.randomize-eyeshot",function(){a(),5==d++&&t("#loginSignupModal").modal("show")}),t("#shareEyeshot .copy-eyeshot-url").on("click",function(){t("#shareEyeshot .eyeshot-url").select(),document.execCommand("copy"),alert("Copied!")}),t("#sv-pano .share-eyeshot").on("click",function(){t("#shareEyeshot").modal("show");var e=n.getPosition().lat(),a=n.getPosition().lng(),o=n.getPano(),s=n.getPov().heading,i=n.getPov().pitch,l=n.getPov().zoom,r=btoa(e+":"+a+":"+o+":"+s+":"+i+":"+l),c="http://eyeshot.xyz?s="+r,h="https://www.facebook.com/sharer/sharer.php?u="+c,u="https://twitter.com/share?url="+c+"&via=eyeshot.xyz&text=roamingAtUnknownPlace";t("#shareEyeshot .share-url input").val(c),t("#shareEyeshot a.share-facebook").attr("href",h),t("#shareEyeshot a.share-twitter").attr("href",u)}),t(".sort-eyeshots select").on("change",function(){window.location="/"+t(this).val()}),t(function(){t(".eyeshot-feed").jscroll({autoTrigger:!0,loadingHtml:'<div class="text-center"><span class="eyeshot-loader">üåè</span></div>',nextSelector:"ul.pagination li.active + li a",contentSelector:"div.eyeshot",pagingSelector:"ul.pagination",callback:function(){t("ul.pagination:visible:first").hide()}})})})(jQuery);