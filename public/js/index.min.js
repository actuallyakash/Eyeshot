(function(e){function t(e,t){var a=e.lng,o=e.lat,s=t/111300,n=Math.random(),i=Math.random(),r=s*Math.sqrt(n),l=2*Math.PI*i,c=r*Math.cos(l),h=r*Math.sin(l),d=c/Math.cos(o);return{lat:h+o,lng:d+a}}function a(){e(".loader").css("display","block"),e("#sv-pano").css("display","none");let a=new URLSearchParams(window.location.search);var o,s;if(a.has("search")){var n=a.get("search");(new google.maps.Geocoder).geocode({address:n},function(e,t){t==google.maps.GeocoderStatus.OK?(o=Number(e[0].geometry.location.lat()),s=Number(e[0].geometry.location.lng()),r(o,s)):console.log("Geocode was not successful for the following reason: "+t)})}else if(a.has("reverse")){var i=a.get("reverse").split(",");o=Number(i[0]),s=Number(i[1]),r(o,s)}else{var l,c=[[],[43.0772733,-79.0659442,2500],[37.869085,-122.254775,2500],[51.5286416,-.1015987,3e4],[-4.3586009,55.8407455,2800],[-4.3235718,55.7260027,7e3],[36.0612757,-112.0867052,2e3],[25.1972018,55.2721877,2e3],[32.628183,129.7385157,800],[65.18264,-19.040652,27e4],[46.603273,8.019498,2e5],[44.132559,9.7011111,500],[45.4376252,12.3238643,1500],[40.7504527,-73.9870021,2e3],[-17.490441,-149.767722,1500],[-25.348539,131.028638,1200],[11.966825,121.926576,2e3],[10.975765,76.736885,900],[-13.898551,-71.282604,2e4],[49.1957991,20.0653766,2e4],[45.8145547,15.9786655,2e4],[29.057055,110.46777,2200],[-22.951311,-43.211112,500],[48.859953,2.292047,1e3],[43.777252,-110.65907,25e3],[28.6145075,77.1978083,2e4],[60.128889,-149.409004,2e4],[50.1262627,8.6672373,15e3],[50.0676221,7.7789231,1e3],[-8.226646,112.916579,1e3],[52.238634,-117.229931,2e3],[]];if(Math.random()>=.5)l=e.ajax({type:"POST",url:"/get/random",async:!1,headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(e){return e}}).responseJSON;else{var h=c[Math.floor(Math.random()*(c.length-1)+1)];l=t({lat:h[0],lng:h[1]},h[2])}o=Number(l.lat),s=Number(l.lng),r(o,s)}e("#landing-pano #sv-pano .gm-style").remove()}var o,s,n=function(t){var a=e("#sv-pano .cta-street-view");if(a.length){a.attr("data-id","fav-"+t);var o="";(o=a.attr("class").match(/fav-\S+/g))&&a.removeClass(o),a.addClass("fav-"+t),e.ajax({type:"GET",url:"/location/"+t+"/status",success:function(e){1==e?(a.attr("title","Unlike"),a.attr("data-original-title","Unlike"),a.removeClass("unfavourite-sv").addClass("favourite-sv"),a.children("i").removeClass("far").addClass("fas")):(a.attr("title","Favourite"),a.attr("data-original-title","Favourite"),a.removeClass("favourite-sv").addClass("unfavourite-sv"),a.children("i").removeClass("fas").addClass("far"))}})}},i=function(t,i,r,l,c,h,d,u){var p=function(t,o){""!==r||void 0!==r?(e(".loader").css("display","none"),e("#sv-pano").css("display","block"),s.setPano(r),s.setPov({heading:l,pitch:c,zoom:h}),s.setVisible(!0)):a()},v={lat:t,lng:i},m=new google.maps.StreetViewService;o=new google.maps.Map(d,{center:v,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0,gestureHandling:"greedy"}),s=new google.maps.StreetViewPanorama(u,{position:v,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),o.setStreetView(s),m.getPanorama({location:v,radius:50},p),o.addListener("click",function(e){m.getPanorama({location:e.latLng,radius:100},p)}),s.addListener("pano_changed",function(){var e=s.getPano();o.panTo(s.getPosition()),n(e)})},r=function(t,i){var r={lat:t,lng:i},l=function(){o=new google.maps.Map(document.getElementById("sv-map"),{center:r,zoom:16,zoomControl:!1,mapTypeControl:!1,streetViewControl:!0,gestureHandling:"greedy"}),o.setStreetView(s),o.addListener("click",function(e){h.getPanorama({location:e.latLng,radius:200},function(e,t){"OK"===t&&(s.setPano(e.location.pano),s.setPov({heading:270,pitch:0,zoom:0}),s.setVisible(!0))})})},c=function(t,i){"OK"===i?(s=new google.maps.StreetViewPanorama(document.getElementById("sv-pano"),{pano:t.location.pano,panControl:!0,fullscreenControl:!0,linksControl:!1,zoomControl:!1,addressControl:!1,enableCloseButton:!1}),s.setPov({heading:270,pitch:0,zoom:0}),n(s.getPano()),s.addListener("pano_changed",function(){var e=s.getPano();o.panTo(s.getPosition()),n(e)}),l(),e(".loader").css("display","none"),e("#sv-pano").css("display","block")):a()},h=new google.maps.StreetViewService;h.getPanorama({location:r,radius:50},c)},l=function(t,a,n){e("#favouriteBox .eyeshot-title").val("");var i=o.streetView.location.description,r=o.center.lat(),l=o.center.lng(),c=s.getPov().heading,h=s.getPov().pitch,d=s.zoom;switch(void 0!==i&&""!==i?e("#favouriteBox .location-name").html("Exploring: <b>"+i+"</b>"):i=null,a){case"favourite":e.ajax({type:"GET",url:"/location/favourite/"+i+"/"+r+"/"+l+"/"+t+"/"+c+"/"+h+"/"+d,success:function(e){1==e?(n.attr("title","Unlike"),n.attr("data-original-title","Unlike"),n.removeClass("unfavourite-sv").addClass("favourite-sv"),n.children("i").removeClass("far").addClass("fas")):console.log("#12 Something went wrong! Can't favourite location.")}});break;case"unfavourite":e.ajax({type:"DELETE",url:"/location/"+t+"/unfavourite/",headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(e){1==e?(n.attr("title","Like"),n.attr("data-original-title","Like"),n.removeClass("favourite-sv").addClass("unfavourite-sv"),n.children("i").removeClass("fas").addClass("far")):console.log("#13 Something went wrong! Can't unfavourite location.")}})}},c=function(t,a,o,s){e.ajax({type:"POST",url:"/favourite/details",data:{panoId:t,title:a,status:o,tags:s},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(t){1==t?(e("#favouriteBox").modal("hide"),e("#favouriteBox textarea.status").val(""),tagify.removeAllTags(),e(".toast-location-share").toast({delay:2e3}),e(".toast-location-share").toast("show")):console.log("#212 Something went wrong! Can't save details.")}})},h=function(t,a){e("#newsletter .subscribe-btn").html('<div class="spinner-border text-light spinner-border-sm" role="status"><span class="sr-only">Loading...</span></div>'),e.ajax({type:"POST",url:"/newsletter",data:{email:t,source:a},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(t){1==t?(e(".newsletter").append('<div class="subscribed text-center"><p>You\'re in! üéâ Check spam :)</p></div>'),e(".newsletter .subscribe-btn").text("Done")):(e(".newsletter").append('<div class="subscribed"><p class="text-danger">#213 Something went wrong!</p></div>'),console.log("#213 Something went wrong!"))}})};e(document).ready(function(){var t,s;e('[data-tooltip="tooltip"]').tooltip(),e("body").scrollspy({target:"#placeholderScrollspy"}),t=document,s=t.createElement("script"),s.src="https://eyeshot.disqus.com/embed.js",s.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(s);var r=0,l=0;if(e(document).mouseleave(function(){r<100&&(l<1&&e("#newsletterModal").modal("show"),l++)}),e("#landing-pano").length&&a(),e("#shared-pano").length){var c=document.querySelector("#shared-pano #sv-map"),h=document.querySelector("#shared-pano #sv-pano");if(new URL(window.location.href).pathname.indexOf("/shot/")>-1){var d=new URL(window.location.href).pathname.split("/")[3];e.ajax({type:"GET",url:"/get/"+d+"/details",success:function(t){if(0!=t){var a=t.latitude,o=t.longitude;if(n(t.pano_id),i(Number(a),Number(o),t.pano_id,Number(t.pano_heading),Number(t.pano_pitch),Number(t.pano_zoom),c,h),e("#shared-pano .eyeshot-location").text(t.location_name),null!==t.tags?e("#shared-pano .eyeshot-title").text(t.title):e("#shared-pano .eyeshot-title").text("Eyeshot by "+t.eyeshot_by),e("#shared-pano .eyeshot-status").text(t.status),null!==t.tags){var s=t.tags.split(",");s.map(t=>e("#shared-pano .eyeshot-tags").append("<a href='/search?q="+t+"' class='eyeshot-tag badge'>"+t+"</a>"))}else e("#shared-pano .eyeshot-tags").append("<a href='/search?q=eyeshot' class='eyeshot-tag badge'>Eyeshot</a>");e("#shared-pano .eyeshot-location").text(t.location_name),e("#shared-pano .eyeshot-published").text(t.created_at),e("#shared-pano .eyeshot-saves").text(t.eyeshot_saves+" saves")}else console.log("No eyeshot found!")}})}else{var u=new URL(window.location.href).searchParams.get("s");e.ajax({type:"GET",url:"/get/share/"+u,success:function(t){var a=atob(t),s=a.split(":");n(s[2]),i(Number(s[0]),Number(s[1]),s[2],Number(s[3]),Number(s[4]),Number(s[5]),c,h),setTimeout(function(){void 0!==o.streetView.location.description&&(e("#shared-pano").after('<div class="details text-center"><h3 class="eyeshot-info"> <span class="text-muted">Location: </span>'+o.streetView.location.description+"</h3></div>"),e("meta.meta-title").attr("content",o.streetView.location.description+" | Eyeshot"),e("meta.meta-keywords").attr("content",o.streetView.location.description),e("meta.meta-image").attr("content","https://maps.googleapis.com/maps/api/streetview?size=600x400&pano="+s[2]+"&heading="+s[3]+"&pitch="+s[4]+"&key="+key))},2e3)},error:function(){alert("Eyeshot not Found! Redirecting you to the homepage..")}})}}e("#landing-pano").on("click",function(){e("html, body").animate({scrollTop:e("#landing-pano").offset().top},100)}),console.log("%cüåè","font-size:20px;"),console.log("%cHaving fun using Eyeshot? Wanna contribute or maybe give a star üòÅ. Join us:\nhttp://github.com/actuallyakash/eyeshot","color: #6697FE; font-size: 12px;")}),e("div#sv-pano").on("click","button.unfavourite-sv",function(){var t=e(this).attr("data-id").replace("fav-",""),a=e("button.fav-"+t);e("#favouriteBox").modal(),l(t,"favourite",a)}),e("div#sv-pano").on("click","button.favourite-sv",function(){var t=e(this).attr("data-id").replace("fav-",""),a=e("button.fav-"+t);l(t,"unfavourite",a)}),e("div#favouriteBox").on("click","button.btn-fav-info",function(t){t.preventDefault();var a=e("div#sv-pano button.cta-street-view").attr("data-id").replace("fav-",""),o=e("input[name=title]").val(),s=e("textarea.status").val(),n=e("input[name=tags]").val();c(a,o,s,n)}),e("div#newsletter").on("click","button.subscribe-btn",function(t){t.preventDefault();var a=e("input[name=email]").val(),o=e("input[name=source]").val();h(a,o)});var d=document.querySelector('#favouriteBox input[name="tags"]');null!==d&&(tagify=new Tagify(d)),e("div.eyeshot-container-fluid").on("click",".eyeshot .eyeshot-media",function(){var t=e(this).data("eyeshot").replace("eyeshot-",""),a=e(this).data("user");e("#viewEyeshot #sv-pano .gm-style").remove(),e("#viewEyeshot").modal("show"),history.pushState({pageID:"Eyeshot"},"Eyeshot","/"+a+"/shot/"+t);var o="http://eyeshot.xyz/"+a+"/shot/"+t,s=t;DISQUS.reset({reload:!0,config:function(){this.page.identifier=s,this.page.url=o}}),e("#viewEyeshot .eyeshot-location").text(""),e("#viewEyeshot .eyeshot-status").text(""),e("#viewEyeshot .eyeshot-tags").text(""),e("#viewEyeshot .loader").css("display","block"),e("#viewEyeshot .modal-content").css("display","none"),e.ajax({type:"GET",url:"/get/"+t+"/details",success:function(t){if(0!=t){var a=t.latitude,o=t.longitude;n(t.pano_id);let r=document.querySelector("#viewEyeshot #sv-map"),l=document.querySelector("#viewEyeshot #sv-pano");if(i(Number(a),Number(o),t.pano_id,Number(t.pano_heading),Number(t.pano_pitch),Number(t.pano_zoom),r,l),e("#viewEyeshot .eyeshot-avatar img").attr("src",t.user_avatar.replace("http://","https://")),e("#viewEyeshot .eyeshot-user .eyeshot-username").html("by <a href='"+t.user_nickname+"'>"+t.eyeshot_by+"</a>"),e("#viewEyeshot .eyeshot-location").text(t.location_name),null!==t.tags?e("#viewEyeshot .eyeshot-title").text(t.title):e("#viewEyeshot .eyeshot-title").text("Eyeshot by "+t.eyeshot_by),e("#viewEyeshot .eyeshot-status").text(t.status),null!==t.tags){var s=t.tags.split(",");s.map(t=>e("#viewEyeshot .eyeshot-tags").append("<a href='/search?q="+t+"' class='eyeshot-tag badge'>"+t+"</a>"))}else e("#viewEyeshot .eyeshot-tags").append("<a href='/search?q=eyeshot' class='eyeshot-tag badge'>Eyeshot</a>");e("#viewEyeshot .eyeshot-location").text(t.location_name),e("#viewEyeshot .eyeshot-published").text(t.created_at),e("#viewEyeshot .eyeshot-saves").text(t.eyeshot_saves+" saves"),e("#viewEyeshot .loader").css("display","none"),e("#viewEyeshot .modal-content").css("display","block")}else console.log("No eyeshot found!")}})}),e("#viewEyeshot").on("hidden.bs.modal",function(){history.pushState({pageID:"Home"},"Eyeshot - Homepage","/")});var u=0;if(e("div#sv-pano").on("click","button.randomize-eyeshot",function(){a(),5==u++&&e("#loginSignupModal").modal("show")}),e("#shareEyeshot .copy-eyeshot-url").on("click",function(){e("#shareEyeshot .eyeshot-url").select(),document.execCommand("copy"),alert("Copied!")}),e("#sv-pano .share-eyeshot").on("click",function(){var t=s.getPosition().lat(),a=s.getPosition().lng(),o=s.getPano(),n=s.getPov().heading,i=s.getPov().pitch,r=s.getPov().zoom,l=btoa(t+":"+a+":"+o+":"+n+":"+i+":"+r);e.ajax({type:"POST",url:"/share",data:{pano:l},headers:{"X-CSRF-TOKEN":e('meta[name="csrf-token"]').attr("content")},success:function(t){var a="http://eyeshot.xyz?s="+t,o="https://www.facebook.com/sharer/sharer.php?u="+a,s="https://twitter.com/share?url="+a+"&via=eyeshotHQ&text=Look%20at%20this...%20%20üëÄ",n=(/Mobi/.test(navigator.userAgent)?"whatsapp://send?text=":"https://web.whatsapp.com/send?text=")+encodeURI("Look at this... üëÄ\n"+a);e("#shareEyeshot .share-url input").val(a),e("#shareEyeshot a.share-facebook").attr("href",o),e("#shareEyeshot a.share-twitter").attr("href",s),e("#shareEyeshot a.share-whatsapp").attr("href",n),e("#shareEyeshot").modal("show")},error:function(){alert("Failed to generate Share URL. Try Again.")}})}),e(".sort-eyeshots select").on("change",function(){window.location="/"+e(this).val()}),e(function(){var t=0;e(".eyeshot-container-fluid").jscroll({autoTrigger:!0,loadingHtml:'<div class="text-center"><span class="eyeshot-loader">üåè</span></div>',nextSelector:"ul.pagination li.active + li a",contentSelector:"div.eyeshot",pagingSelector:"ul.pagination",callback:function(){e(this).prev().append(e(this).children(".eyeshot")),e(this).remove(),2==++t&&e(".eyeshot-container-fluid").append('<div class="text-center"><a class="button-es btn mt-1" href="/feed">See more üòç</a></div>')}})}),"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js")}),!window.matchMedia("(display-mode: standalone)").matches){let t,a,o=e("#pwa-snackbar");window.addEventListener("beforeinstallprompt",e=>{t=e}),a=sessionStorage.getItem("eyeshot-pwa-notif")||"","yes"!=a&&(setTimeout(function(){o.addClass("show")},6e4),sessionStorage.setItem("eyeshot-pwa-notif","yes")),e(o).on("click",".close",function(e){o.removeClass("show")}),e("#pwa-snackbar").on("click",".pwa-body",function(){t.prompt(),o.removeClass("show")}),e("#app-install .pwa-install").on("click",function(){t.prompt()})}})(jQuery);